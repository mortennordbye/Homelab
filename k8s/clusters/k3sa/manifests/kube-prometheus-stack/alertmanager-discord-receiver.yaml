apiVersion: monitoring.coreos.com/v1alpha1
kind: AlertmanagerConfig
metadata:
  name: discord-alerts
  namespace: kube-prometheus-stack
spec:
  route:
    receiver: discord
    groupBy: ['alertname', 'namespace']
    group_wait: 30s
    group_interval: 5m
    repeat_interval: 1h
    continue: true
    matchers:
      - name: alertname
        matchType: "=~"
        value: "DiskUsageCritical|DiskUsageWarning"
      - name: severity
        matchType: "="
        value: "warning"
  receivers:
    - name: discord
      webhookConfigs:
        - urlSecret:
            name: alertmanager-discord-webhook-secret
            key: api-url
          sendResolved: true
          maxAlerts: 5
